<div class="card mb-3 post-card <%= typeof fullView === 'undefined' || !fullView ? 'clickable' : '' %>" 
     <%= typeof fullView === 'undefined' || !fullView ? `onclick="window.location.href='/post/${post.id}'"` : '' %>>
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3" onclick="event.stopPropagation()">
      <div class="d-flex align-items-center">
        <a href="/user/@<%= post.username %>" class="text-decoration-none">
          <strong class="text-primary">@<%= post.username %></strong>
        </a>
        <small class="text-muted ms-2">
          <%= new Date(post.created_at).toLocaleString() %>
        </small>
      </div>
    </div>

    <div class="markdown-content" onclick="event.stopPropagation()">
      <%- post.htmlContent || post.content %>
    </div>

    <div class="mt-3" onclick="event.stopPropagation()">
      <small class="text-muted">
        <%= post.likeCount || 0 %> likes
      </small>
    </div>
  </div>
</div>

<% if (!locals.hideScripts) { %>
<script>
async function toggleLike(postId) {
  try {
    const response = await fetch(`/post/${postId}/like`, {
      method: 'POST',
      headers: {
        'CSRF-Token': document.querySelector('[name="_csrf"]').value
      }
    });
    if (response.ok) window.location.reload();
  } catch (error) {
    console.error('Error toggling like:', error);
  }
}

async function deletePost(postId) {
  if (!confirm('Are you sure you want to delete this post?')) return;
  try {
    const response = await fetch(`/post/${postId}`, {
      method: 'DELETE',
      headers: {
        'CSRF-Token': document.querySelector('[name="_csrf"]').value
      }
    });
    if (response.ok) window.location.href = '/';
  } catch (error) {
    console.error('Error deleting post:', error);
  }
}
</script>
<% } %>